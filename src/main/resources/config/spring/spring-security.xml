<?xml version="1.0" encoding="UTF-8"?>
<beans:beans
	xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans  
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd  
           http://www.springframework.org/schema/security  
           http://www.springframework.org/schema/security/spring-security-3.2.xsd">

	<!-- 不拦截的地址 -->

	<http pattern="/base_html/index/login.jsp" security="none" />
	<http pattern="/base_html/index/loginCa.jsp" security="none" />
	<http pattern="/base_html/index/forgetPassword.jsp"
		security="none" />
	<http pattern="/base_html/index/loginRepeatLogin.html"
		security="none" />
	<http pattern="/base_html/index/accessDenied.html" security="none" />
	<http pattern="/jcaptcha/generatImage.do" security="none" />
	<http pattern="/user/mail.do" security="none" />
	<http pattern="/user/resetCheck.do" security="none" />
	<http pattern="/user/reset.do" security="none" />

	<http pattern="/hitworth/**" security="none" />
	<http pattern="/base_ui/**" security="none" />
	
	<!--	-->
	<http pattern="/lab/*.do" security="none" />
	<http pattern="/marking/*.do" security="none" />
 	<http pattern="/function/*.do" security="none" />
	<http pattern="/user/*.do" security="none" /> 
	<http pattern="/oss/*.do" security="none" />
	<http pattern="/osscallback/*.do" security="none" />
	<http pattern="/role/**" security="none" />

	<!-- 不拦截的地址 end -->


	<!-- 普通登陆 -->
	<http auto-config="true" use-expressions="true"
		access-denied-page="/base_html/index/accessDenied.html">
		<form-login
			login-page="/base_html/index/login.jsp?login=true"
			authentication-failure-url="/base_html/index/login.jsp?error=true&amp;authentication=false"
			default-target-url="/index.html" always-use-default-target="true" />
		<logout invalidate-session="true"
			logout-success-url="/base_html/index/login.jsp" />
		<http-basic />
		<intercept-url pattern="/**" access="authenticated"
			requires-channel="any" />

		<!-- URL权限校验 -->
		<custom-filter ref="hitworthFrameworkFilter"
			before="FILTER_SECURITY_INTERCEPTOR" />
		<!--防止用户重复登陆 ,后登陆用户提到前面用户 -->
<!-- 		<session-management>
			<concurrency-control max-sessions="1"
				expired-url="/base_html/index/loginRepeatLogin.html" />
		</session-management> -->

	</http>

	<!-- 功能请求权限检查 -->
	<beans:bean id="hitworthFrameworkFilter"
		class="com.hitworth.framework.base.security.filter.FilterSecurityInterceptor">
		<beans:property name="authenticationManager"
			ref="hitworthAuthenticationManager" />
		<!-- 访问决策器，决定某个用户具有的角色，是否有足够的权限去访问某个资源 -->
		<beans:property name="accessDecisionManager"
			ref="hitworthAccessDecisionManager" />
		<beans:property name="securityMetadataSource"
			ref="hitworthSecurityMetadataSource" />
	</beans:bean>
	<!-- 资源源数据定义，将所有的资源和权限对应关系建立起来，即定义某一资源可以被哪些角色访问 -->
	<beans:bean id="hitworthSecurityMetadataSource"
		init-method="loadResourceDefine"
		class="com.hitworth.framework.base.security.InvocationSecurityMetadataSourceService">
		<beans:property name="roleService" ref="roleService" />
		<beans:property name="functionService"
			ref="functionService" />
	</beans:bean>


	<!-- 自定义Provider,同时处理普通用户和ca用户登陆 -->
	<authentication-manager
		alias="hitworthAuthenticationManager">
		<authentication-provider
			ref="hitworthProvider" />
	</authentication-manager>

	<beans:bean id="hitworthProvider"
		class="com.hitworth.framework.base.security.provider.CaAuthenticationProvider">
		<beans:property name="userDetailsService"
			ref="userDetailsService" />
	</beans:bean>

	<!-- 国际化 -->
	<beans:bean id="messageSource"
		class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
		<beans:property name="basename"
			value="classpath:config/properties/messages_zh_CN" />
	</beans:bean>
	<beans:bean id="localeResolver"
		class="org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver" />
	<!-- 国际化 end -->

</beans:beans>   