(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{G2UW:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("备案查询")]),t._v(" "),a("Form",{ref:"formQuery",attrs:{model:t.formQuery,inline:""}},[a("FormItem",[a("Select",{staticStyle:{width:"300px"},attrs:{placeholder:"选择品类"},model:{value:t.formQuery.category_id,callback:function(e){t.$set(t.formQuery,"category_id",e)},expression:"formQuery.category_id"}},t._l(t.categoryList,function(e){return a("Option",{key:e.ec_model_no,attrs:{value:e.ec_model_no}},[t._v(t._s(e.ec_model_title))])}))],1),t._v(" "),a("FormItem",[a("Input",{attrs:{type:"text",placeholder:"产品型号"},model:{value:t.formQuery.model_name,callback:function(e){t.$set(t.formQuery,"model_name",e)},expression:"formQuery.model_name"}})],1),t._v(" "),a("FormItem",[a("Input",{attrs:{type:"text",placeholder:"实验室报告条码"},model:{value:t.formQuery.bar_code,callback:function(e){t.$set(t.formQuery,"bar_code",e)},expression:"formQuery.bar_code"}})],1),t._v(" "),a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:t.searchFun}},[t._v("搜索")]),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:t.clearFun}},[t._v("清空")])],1)],1),t._v(" "),a("Table",{attrs:{border:"",columns:t.columns1,data:t.recordData}}),t._v(" "),a("Page",{staticStyle:{"margin-top":"10px","text-align":"right"},attrs:{total:t.total,"page-size":10},on:{"on-change":t.changeList}}),t._v(" "),a("Modal",{attrs:{title:"上传标识图"},model:{value:t.modal1,callback:function(e){t.modal1=e},expression:"modal1"}},[a("Upload",{staticStyle:{display:"inline-block"},attrs:{format:["jpg","jpeg","png"],"before-upload":t.fileHandleBeforeUpload,data:t.uploadParam.fileData,"on-success":t.getFile,action:t.uploadUrl}},[a("Button",{attrs:{icon:"ios-cloud-upload-outline",type:"primary"}},[t._v("上传")])],1)],1)],1)},n=[],r=(a("f3/d"),a("VRzm"),a("vDqi")),i=a.n(r),l={data:function(){var t=this,e=function(e,a){return e("Button",{props:{type:"primary",size:"small",long:"long"},style:{margin:"3px"},on:{click:function(){t.downloadQrcode(a.row.id)}}},"下载二维码")},a=function(e,a){return e("Button",{props:{type:"primary",size:"small",long:"long"},style:{margin:"3px"},on:{click:function(){t.uploadPic(a.row.id)}}},"标识图上传")},o=function(e,a){return e("Button",{props:{type:"primary",size:"small",long:"long"},style:{margin:"3px"},on:{click:function(){t.downloadElImg(a.row.id)}}},"下载能效标识图")},n=function(e,a){return e("Button",{props:{type:"primary",size:"small",long:"long"},style:{margin:"3px"},on:{click:function(){t.extendHandle(a.row.id)}}},"扩展")},r=function(e,a){return e("Button",{props:{type:"primary",size:"small",long:"long"},style:{margin:"3px"},on:{click:function(){t.updateHandle(a.row.id)}}},"变更")};return{total:0,fileObj:{},modal1:!1,id:"",uploadUrl:"",uploadParam:{fileData:{},uploadFileList:[]},formQuery:{category_id:"",model_name:"",bar_code:"",pageSize:10,pageNum:1},categoryList:[],columns1:[{title:"大类",key:"category_name",align:"center"},{title:"型号",key:"model_name",align:"center"},{title:"实验室报告条码",key:"bar_code",align:"center"},{title:"备案号",key:"record_no",align:"center"},{title:"状态",key:"state",align:"center",render:function(t,e){return t("span",{},1===e.row.state?"草稿":2===e.row.state?"标识图制作中":3===e.row.state?"数据同步中":10===e.row.state?"已公告":"")}},{title:"备案类型",key:"type_name",align:"center"},{title:"操作",key:"action",align:"center",render:function(t,i){return t("div",[e(t,i),2===i.row.state?a(t,i):o(t,i),i.row.kz?n(t,i):"",i.row.bg?r(t,i):""])}}],recordData:[]}},mounted:function(){this.getCategoryList(),this.reqData()},methods:{reqData:function(){var t=this;i.a.get("/marking/list.do",{params:this.formQuery}).then(function(e){t.recordData=e.data.list,t.total=e.data.total})},changeList:function(t){this.formQuery.pageNum=t,this.reqData()},searchFun:function(){this.formQuery.pageNum=1,this.reqData()},clearFun:function(){this.formQuery.category_id="",this.formQuery.model_name="",this.formQuery.bar_code="",this.searchFun()},downloadQrcode:function(t){window.open("/marking/downloadQrcode.do?id="+t)},downloadElImg:function(t){window.open("/marking/downloadELImg.do?id="+t)},getRandom:function(t){return Math.random().toString().slice(2)+t},getImgPath:function(t){var e=t,a=new Date,o=a.getFullYear(),n=a.getMonth()>8?a.getMonth()+1:"0"+(a.getMonth()+1),r=a.getDate()>9?a.getDate():"0"+a.getDate();e+=o+"/"+n+"/"+r+"/",this.dir=e},fileHandleBeforeUpload:function(t){var e=this;this.uploadParam.uploadFileList=[];var a=t.name,o=a.lastIndexOf("."),n=a.substring(o).toLowerCase(),r=this.getRandom(n);return this.fileObj.id=this.id,this.fileObj.ec_attach_originalname=t.name,this.fileObj.ec_attach_file=r,Object.defineProperty(t,"name",{writable:!0,value:r}),new Promise(function(a,o){i.a.get("/oss/token.do").then(function(o){if(e.uploadParam.uploadFileList.length>0)return e.$Notice.warning({title:"最多上传1个附件"}),!1;var n=new FileReader;n.readAsDataURL(t),n.onloadend=function(a){t.url=n.result,e.uploadParam.uploadFileList.push(t)},e.getImgPath(o.data.dir),console.log(e.dir+t.name),e.uploadParam.fileData["key"]=e.dir+t.name,e.uploadParam.fileData["policy"]=o.data.policy,e.uploadParam.fileData["OSSAccessKeyId"]=o.data.accessid,e.uploadParam.fileData["success_action_status"]="200",e.uploadParam.fileData["signature"]=o.data.signature,e.uploadUrl=o.data.host,e.fileObj.ec_attach_path=o.data.host+e.dir+t.name,a()})})},uploadPic:function(t){this.modal1=!0,this.fileObj={},this.id=t},getFile:function(t,e){var a=this;i.a.get("/marking/uploadQrcode.do",{params:this.fileObj}).then(function(t){"1"===t.data.result_code&&(a.modal1=!1,a.pageNum=1,a.reqData())})},getCategoryList:function(){var t=this;i.a.get("/marking/getCategoryList.do").then(function(e){"1"===e.data.result_code&&(t.categoryList=e.data.data)})},updateHandle:function(t){this.$router.push({name:"addRecord",params:{type:"update",id:t}})},extendHandle:function(t){var e=this;i.a.get("/marking/getInfoWithoutAttach.do",{params:{id:t}}).then(function(a){"1"===a.data.result_code&&(e.$router.push({name:"addRecord",params:{step:3,type:"extend",id:t,extendData:a.data}}),e.$store.commit("setModelNo",a.data.marking.ec_model_no))})}}},d=l,s=a("KHd+"),c=Object(s["a"])(d,o,n,!1,null,null,null);e["default"]=c.exports}}]);